AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Parameters:
  CallableEndpoint:
    Type: String
    Description: endpoint of a deployed Callable instance
  CallableUser:
    Type: String
  CallablePassword:
    Type: String
    NoEcho: true
  IdocReference:
    Type: String
    Description: Idoc Reference as it is generated by the Callable UI, e.g. BUPAFS_FS_CREATE_FRM_DATA01/BUPA_FS_CREATE_FRM_DATA
Resources:
  InvokeCallable:
    Type: AWS::Serverless::Function
    Properties:
      Handler: index.handler
      Runtime: nodejs10.x
      Timeout: 60
      Policies: AWSLambdaExecute
      Environment:
        Variables:
          endpoint: !Ref CallableEndpoint
          idoc: !Ref IdocReference
          user: !Ref CallableUser
          password: !Ref CallablePassword
      Events:
        S3CreateObjectEvent:
          Type: S3
          Properties:
            Bucket: !Ref IdocBucket
            Events: s3:ObjectCreated:*
  IdocBucket:
    Type: AWS::S3::Bucket
Outputs:
  IdocBucket:
    Value: !Ref IdocBucket